@if (IsVisible)
{
    <div class="modal show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);"
         @onkeydown="HandleKeyDown"
         @ref="modalElement">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Push</h5>
                    <button type="button" class="btn-close" aria-label="Close" @onclick="OnCancel"></button>
                </div>
                <div class="modal-body">
                    @if (IsMultiLevel)
                    {
                        <p class="mb-0">
                            Repositories span multiple dependency levels. Push will run from lowest to highest level. At each level, the app will wait until required packages are available in the package registry before pushing.
                        </p>
                        <p class="mb-0 mt-2">
                            <strong>Proceed</strong> with dependency-synchronized push?
                        </p>
                    }
                    else
                    {
                        <p class="mb-0">
                            Push all repositories and set upstream for the current branch (even when there are no commits to push).
                        </p>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" @onclick="OnProceed" disabled="@IsBusy">
                        @if (IsBusy)
                        {
                            <span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
                        }
                        Proceed
                    </button>
                    <button type="button" class="btn btn-outline-secondary" @onclick="OnCancel" disabled="@IsBusy">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public bool IsVisible { get; set; }
    [Parameter] public bool IsMultiLevel { get; set; }
    [Parameter] public bool IsBusy { get; set; }
    [Parameter] public EventCallback OnProceed { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }

    private ElementReference modalElement;

    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Escape")
            await OnCancel.InvokeAsync();
    }
}
